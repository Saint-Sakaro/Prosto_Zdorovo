# –ó–∞–¥–∞–Ω–∏–µ –¥–ª—è –±—ç–∫–µ–Ω–¥–µ—Ä–∞: –°–∏—Å—Ç–µ–º–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –∞–Ω–∫–µ—Ç –∏ —Ä–∞—Å—á–µ—Ç–∞ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤

## üìå –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É —Ä–∞—Å—á–µ—Ç–∞ **Health Impact Score (HIS)** 0-100 –¥–ª—è –æ–±—ä–µ–∫—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ:
1. **–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫** (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –∞–Ω–∫–µ—Ç—ã —Å –ø–æ–ª—è–º–∏ –∏ –≤–µ—Å–∞–º–∏)
2. **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –æ—Ç–∑—ã–≤–æ–≤** (—Å —É—á–µ—Ç–æ–º –≤—Ä–µ–º–µ–Ω–∏ –∏ —Ä–µ–ø—É—Ç–∞—Ü–∏–∏ –∞–≤—Ç–æ—Ä–æ–≤)

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

–í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏ `# TODO:` - –Ω—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É.

### –≠—Ç–∞–ø 1: –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
- `maps/models_ratings.py` - –º–æ–¥–µ–ª—å FormSchema (–≥–æ—Ç–æ–≤–∞)
- `maps/models_updates.py` - –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –º–æ–¥–µ–ª–µ–π
- **–ù—É–∂–Ω–æ:** –î–æ–±–∞–≤–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ `maps/models.py` –∏ `gamification/models.py`

### –≠—Ç–∞–ø 2: –°–µ—Ä–≤–∏—Å—ã —Ä–∞—Å—á–µ—Ç–∞
- `maps/services/infrastructure_score_calculator.py` - —Ä–∞—Å—á–µ—Ç S_infra
- `maps/services/social_score_calculator.py` - —Ä–∞—Å—á–µ—Ç S_social
- `maps/services/health_impact_score_calculator.py` - —Ä–∞—Å—á–µ—Ç –∏—Ç–æ–≥–æ–≤–æ–≥–æ HIS
- **–ù—É–∂–Ω–æ:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏ `# TODO:`

### –≠—Ç–∞–ø 3: LLM –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `maps/services/llm_service.py` - –±–∞–∑–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è LLM
- **–ù—É–∂–Ω–æ:** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã

### –≠—Ç–∞–ø 4: API –∏ —Å–∏–≥–Ω–∞–ª—ã
- `maps/signals_ratings.py` - —Å–∏–≥–Ω–∞–ª—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ—Å—á–µ—Ç–∞
- `maps/serializers_ratings.py` - serializers –¥–ª—è API
- `maps/views_ratings.py` - views –¥–ª—è API
- `maps/urls_ratings.py` - URL –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- **–ù—É–∂–Ω–æ:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –∏ –ø–æ–¥–∫–ª—é—á–∏—Ç—å

### –≠—Ç–∞–ø 5: –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
- `maps/tasks_ratings.py` - Celery –∑–∞–¥–∞—á–∏
- `health_map/celery.py` - –æ–±–Ω–æ–≤–ª–µ–Ω (–¥–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–¥–∞—á–∞)
- **–ù—É–∂–Ω–æ:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∑–∞–¥–∞—á–∏

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

1. **`STAGE_BY_STAGE_IMPLEMENTATION.md`** - **–ù–ê–ß–ù–ò–¢–ï –û–¢–°–Æ–î–ê!**
   - –ü–æ—ç—Ç–∞–ø–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∫–æ–¥–∞
   - –ß–µ–∫-–ª–∏—Å—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞
   - –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

2. **`IMPLEMENTATION_GUIDE.md`** - –ø–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
   - –§–æ—Ä–º—É–ª—ã —Ä–∞—Å—á–µ—Ç–∞
   - –ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
   - –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

3. **`ARCHITECTURE_PLAN.md`** - –æ–±—â–∏–π –ø–ª–∞–Ω –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

4. **`ARCHITECT_PROMPT.md`** - –∏—Å—Ö–æ–¥–Ω–æ–µ –¢–ó –æ—Ç –∑–∞–∫–∞–∑—á–∏–∫–∞

5. **`otzovy.tex`** - —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ –Ω–∞ LaTeX

## üöÄ –ü–æ—Ä—è–¥–æ–∫ —Ä–∞–±–æ—Ç—ã

### –®–∞–≥ 1: –ò–∑—É—á–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
- –ü—Ä–æ—á–∏—Ç–∞—Ç—å `STAGE_BY_STAGE_IMPLEMENTATION.md`
- –ò–∑—É—á–∏—Ç—å `ARCHITECT_PROMPT.md` –∏ `otzovy.tex`
- –ü–æ–Ω—è—Ç—å —Ñ–æ—Ä–º—É–ª—ã —Ä–∞—Å—á–µ—Ç–∞

### –®–∞–≥ 2: –≠—Ç–∞–ø 1 - –ú–æ–¥–µ–ª–∏ (1-2 –¥–Ω—è)
1. –û—Ç–∫—Ä—ã—Ç—å `maps/models_ratings.py` –∏ `maps/models_updates.py`
2. –î–æ–±–∞–≤–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–æ–¥–µ–ª–∏
3. –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏: `python manage.py makemigrations`
4. –ü—Ä–∏–º–µ–Ω–∏—Ç—å: `python manage.py migrate`
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ë–î

### –®–∞–≥ 3: –≠—Ç–∞–ø 2 - –°–µ—Ä–≤–∏—Å—ã (2-3 –¥–Ω—è)
1. –û—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª—ã –≤ `maps/services/`
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏ `# TODO:`
3. –ù–∞–ø–∏—Å–∞—Ç—å unit-—Ç–µ—Å—Ç—ã
4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### –®–∞–≥ 4: –≠—Ç–∞–ø 3 - LLM (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, 2-3 –¥–Ω—è)
- –ú–æ–∂–Ω–æ –æ—Ç–ª–æ–∂–∏—Ç—å
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∑–∞–≥–ª—É—à–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –®–∞–≥ 5: –≠—Ç–∞–ø 4 - API –∏ —Å–∏–≥–Ω–∞–ª—ã (1-2 –¥–Ω—è)
1. –ü–æ–¥–∫–ª—é—á–∏—Ç—å —Å–∏–≥–Ω–∞–ª—ã –≤ `maps/apps.py`
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –≤ `maps/signals_ratings.py`
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å views –≤ `maps/views_ratings.py`
4. –ü–æ–¥–∫–ª—é—á–∏—Ç—å URLs (—É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ `maps/urls.py`)
5. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å API

### –®–∞–≥ 6: –≠—Ç–∞–ø 5 - –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ (1 –¥–µ–Ω—å)
1. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∑–∞–¥–∞—á–∏ –≤ `maps/tasks_ratings.py`
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Celery (—É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ `celery.py`)
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏

## üìä –§–æ—Ä–º—É–ª—ã —Ä–∞—Å—á–µ—Ç–∞ (–∫—Ä–∞—Ç–∫–æ)

### S_infra (–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥)
```
–î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—è –∞–Ω–∫–µ—Ç—ã:
  s_i = normalize_field_value(field, value)
  –ï—Å–ª–∏ direction == -1: s_i = 1 - s_i

S_infra = 100 * Œ£(w_i * s_i) / Œ£(|w_i|)
```

### S_social (–°–æ—Ü–∏–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥)
```
–î–ª—è –∫–∞–∂–¥–æ–≥–æ –æ—Ç–∑—ã–≤–∞:
  s_j = (rating_j - 1) / 4  # –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è 1-5 ‚Üí 0-1
  w_time = 2^(-age_days / 180)  # Time decay
  w_author = f(reputation)  # –í–µ—Å –∞–≤—Ç–æ—Ä–∞
  w_j = w_time * w_author

S_social = 100 * Œ£(w_j * s_j) / Œ£(w_j)
–ï—Å–ª–∏ –æ—Ç–∑—ã–≤–æ–≤ –Ω–µ—Ç: S_social = 50
```

### S_HIS (–ò—Ç–æ–≥–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å)
```
S_base = 0.7 * S_infra + 0.3 * S_social
S_HIS = S_base + (5.0 if verified else 0.0)
S_HIS = min(100, max(0, S_HIS))
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:** –ü–æ–ª–µ `health_score` –≤ POIRating –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∞–ª–∏–∞—Å–æ–º –¥–ª—è `S_HIS`

2. **–ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:** –î–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å:
   - S_infra = 50.0
   - S_social = 50.0
   - S_HIS = 50.0

3. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** 
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `select_related`/`prefetch_related`
   - –ü–µ—Ä–µ—Å—á–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤

4. **–í–∞–ª–∏–¥–∞—Ü–∏—è:** 
   - –ü—Ä–æ–≤–µ—Ä—è—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –∞–Ω–∫–µ—Ç—ã
   - –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π —Å—Ö–µ–º–µ

## ‚ùì –í–æ–ø—Ä–æ—Å—ã –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è

1. ‚úÖ LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä: **GIGACHAT** (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ –∫–æ–¥–µ)
2. –ö–∞–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤–µ—Å–æ–≤ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã? (infra_weight=0.7, social_weight=0.3)
3. –ö–∞–∫–æ–π –ø–µ—Ä–∏–æ–¥ –ø–æ–ª—É—Ä–∞—Å–ø–∞–¥–∞ –¥–ª—è time decay? (180 –¥–Ω–µ–π –∏–∑ –¢–ó)
4. –ù—É–∂–Ω–∞ –ª–∏ –º–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö?

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä—É –ø—Ä–æ–µ–∫—Ç–∞.

---

**–ù–∞—á–Ω–∏—Ç–µ —Å —Ñ–∞–π–ª–∞ `STAGE_BY_STAGE_IMPLEMENTATION.md` - —Ç–∞–º –ø–æ–¥—Ä–æ–±–Ω–∞—è –ø–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è!**


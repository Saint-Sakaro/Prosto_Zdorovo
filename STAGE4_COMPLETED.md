# ‚úÖ –≠–¢–ê–ü 4: API –∏ —Å–∏–≥–Ω–∞–ª—ã - –ó–ê–í–ï–†–®–ï–ù

## üéâ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

### 1. ‚úÖ –°–∏–≥–Ω–∞–ª—ã Django - –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
**–§–∞–π–ª:** `maps/signals_ratings.py`

**–°–∏–≥–Ω–∞–ª—ã:**

#### `recalculate_rating_on_poi_change`
- –°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ POI
- –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ `form_data` –∏–ª–∏ `form_schema`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `HealthImpactScoreCalculator`

#### `recalculate_rating_on_review_change`
- –°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –æ—Ç–∑—ã–≤–∞
- –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥ –ø—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ –æ—Ç–∑—ã–≤–∞ (approved)
- –ù–∞—Ö–æ–¥–∏—Ç POI —á–µ—Ä–µ–∑ –ø—Ä—è–º—É—é —Å–≤—è–∑—å –∏–ª–∏ –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º

#### `recalculate_rating_on_review_delete`
- –°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –æ—Ç–∑—ã–≤–∞
- –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥ –¥–ª—è —Å–≤—è–∑–∞–Ω–Ω–æ–≥–æ POI

#### `analyze_review_with_llm`
- –°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏/–∏–∑–º–µ–Ω–µ–Ω–∏–∏ –æ—Ç–∑—ã–≤–∞
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –æ—Ç–∑—ã–≤ —á–µ—Ä–µ–∑ LLM
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ —Ñ–∞–∫—Ç—ã –∏ —Å–µ–Ω—Ç–∏–º–µ–Ω—Ç
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å–µ–Ω—Ç–∏–º–µ–Ω—Ç–∞ –∏ –æ—Ü–µ–Ω–∫–∏

**–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:** –°–∏–≥–Ω–∞–ª—ã –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –≤ `maps/apps.py`

### 2. ‚úÖ API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
**–§–∞–π–ª:** `maps/views_ratings.py`

**ViewSets –∏ Views:**

#### `FormSchemaViewSet`
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ö–µ–º–∞–º–∏ –∞–Ω–∫–µ—Ç (CRUD)
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ö–µ–º —á–µ—Ä–µ–∑ LLM (`generate_for_category`)
- –£—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å—Ö–µ–º (`approve`)

**–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã:**
- `GET /api/maps/ratings/form-schemas/` - —Å–ø–∏—Å–æ–∫ —Å—Ö–µ–º
- `POST /api/maps/ratings/form-schemas/` - —Å–æ–∑–¥–∞—Ç—å —Å—Ö–µ–º—É
- `GET /api/maps/ratings/form-schemas/{id}/` - –¥–µ—Ç–∞–ª–∏ —Å—Ö–µ–º—ã
- `PUT /api/maps/ratings/form-schemas/{id}/` - –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ö–µ–º—É
- `POST /api/maps/ratings/form-schemas/generate-for-category/` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ LLM
- `POST /api/maps/ratings/form-schemas/{id}/approve/` - —É—Ç–≤–µ—Ä–¥–∏—Ç—å —Å—Ö–µ–º—É

#### `POIFormDataView`
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∞–Ω–∫–µ—Ç—ã –æ–±—ä–µ–∫—Ç–∞

**–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã:**
- `PUT /api/maps/ratings/pois/{uuid}/form-data/` - –æ–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∞–Ω–∫–µ—Ç—ã

#### `POIRatingViewSet`
- –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–π—Ç–∏–Ω–≥–æ–≤ –æ–±—ä–µ–∫—Ç–æ–≤
- –†—É—á–Ω–æ–π –ø–µ—Ä–µ—Å—á–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥–æ–≤

**–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã:**
- `GET /api/maps/ratings/ratings/` - —Å–ø–∏—Å–æ–∫ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤
- `GET /api/maps/ratings/ratings/{id}/` - –¥–µ—Ç–∞–ª–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞
- `POST /api/maps/ratings/ratings/{id}/recalculate/` - –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å —Ä–µ–π—Ç–∏–Ω–≥

### 3. ‚úÖ Serializers - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
**–§–∞–π–ª:** `maps/serializers_ratings.py`

**Serializers:**

#### `FormSchemaSerializer`
- –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ö–µ–º –∞–Ω–∫–µ—Ç
- –í–∞–ª–∏–¥–∞—Ü–∏—è JSON —Å—Ö–µ–º—ã
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–ª–µ–π —á–µ—Ä–µ–∑ `FormFieldSerializer`

#### `POIFormDataSerializer`
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∞–Ω–∫–µ—Ç—ã
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö

#### `POIRatingDetailSerializer`
- –î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–π—Ç–∏–Ω–≥–∞
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã: S_infra, S_social, S_HIS

**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** `POIRatingSerializer` –≤ `maps/serializers.py` –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π

### 4. ‚úÖ URL –ú–∞—Ä—à—Ä—É—Ç—ã - –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã
**–§–∞–π–ª:** `maps/urls_ratings.py`

- –í—Å–µ –º–∞—Ä—à—Ä—É—Ç—ã –ø–æ–¥–∫–ª—é—á–µ–Ω—ã —á–µ—Ä–µ–∑ —Ä–æ—É—Ç–µ—Ä
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `maps/urls.py`

### 5. ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Å—á–µ—Ç
- –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ `form_data` –æ–±—ä–µ–∫—Ç–∞ ‚Üí –ø–µ—Ä–µ—Å—á–µ—Ç S_infra
- –ü—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ –æ—Ç–∑—ã–≤–∞ ‚Üí –ø–µ—Ä–µ—Å—á–µ—Ç S_social
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –æ—Ç–∑—ã–≤–∞ ‚Üí –ø–µ—Ä–µ—Å—á–µ—Ç S_social
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –∏—Ç–æ–≥–æ–≤–æ–≥–æ S_HIS

## üîß –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### –°–∏–≥–Ω–∞–ª—ã –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –≤ apps.py
```python
def ready(self):
    import maps.signals
    import maps.signals_ratings
```

### URL –º–∞—Ä—à—Ä—É—Ç—ã
```
/api/maps/ratings/form-schemas/...
/api/maps/ratings/ratings/...
/api/maps/ratings/pois/{uuid}/form-data/
```

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

- [x] –°–∏–≥–Ω–∞–ª—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã
- [x] API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —Å–æ–∑–¥–∞–Ω—ã
- [x] Serializers —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- [x] URL –º–∞—Ä—à—Ä—É—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [x] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Å—á–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è LLM –≤ –ø—Ä–æ—Ü–µ—Å—Å –∞–Ω–∞–ª–∏–∑–∞ –æ—Ç–∑—ã–≤–æ–≤
- [x] –ù–µ—Ç TODO –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
- [x] –ù–µ—Ç –æ—à–∏–±–æ–∫ –ª–∏–Ω—Ç–µ—Ä–∞

## üöÄ –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥

**–≠–¢–ê–ü 5: –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏**
- Celery –∑–∞–¥–∞—á–∏ –¥–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ—Å—á–µ—Ç–∞
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Celery Beat –¥–ª—è time decay
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

---

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 2025-12-06
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–û–¢–û–í–û


# ‚úÖ –≠–¢–ê–ü 2: –°–µ—Ä–≤–∏—Å—ã —Ä–∞—Å—á–µ—Ç–∞ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤ - –ó–ê–í–ï–†–®–ï–ù

## üéâ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

### 1. ‚úÖ InfrastructureScoreCalculator - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω
**–§–∞–π–ª:** `maps/services/infrastructure_score_calculator.py`

**–ú–µ—Ç–æ–¥—ã:**
- `calculate_infra_score(poi)` - –†–∞—Å—á–µ—Ç S_infra –¥–ª—è –æ–±—ä–µ–∫—Ç–∞
  - –ü–æ–ª—É—á–∞–µ—Ç —Å—Ö–µ–º—É –∞–Ω–∫–µ—Ç—ã –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
  - –ù–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–ª–µ–π
  - –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –≤–∑–≤–µ—à–µ–Ω–Ω—É—é —Å—É–º–º—É
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥ 0-100

- `normalize_field_value(field, value)` - –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª—è –≤ [0;1]
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–∏–ø–æ–≤: boolean, range, select, photo
  - –£—á–µ—Ç direction –¥–ª—è boolean –∏ range
  - –î–ª—è range: (value - min) / (max - min)
  - –î–ª—è direction=-1: –∏–Ω–≤–µ—Ä—Å–∏—è –∑–Ω–∞—á–µ–Ω–∏—è

- `calculate_weighted_sum(normalized_values, weights)` - –í–∑–≤–µ—à–µ–Ω–Ω–∞—è —Å—É–º–º–∞
  - –§–æ—Ä–º—É–ª–∞: sum(w_i * s_i) / sum(|w_i|)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –£—á–∏—Ç—ã–≤–∞–µ—Ç –≤–µ—Å–∞ –ø–æ–ª–µ–π –∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–ª–∏—è–Ω–∏—è
- –ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ 50.0 –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –ø–æ–ª–µ–π

### 2. ‚úÖ SocialScoreCalculator - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω
**–§–∞–π–ª:** `maps/services/social_score_calculator.py`

**–ú–µ—Ç–æ–¥—ã:**
- `calculate_social_score(poi, reviews=None)` - –†–∞—Å—á–µ—Ç S_social
  - –ü–æ–ª—É—á–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ –æ—Ç–∑—ã–≤—ã –¥–ª—è POI
  - –£—á–∏—Ç—ã–≤–∞–µ—Ç time decay –∏ —Ä–µ–ø—É—Ç–∞—Ü–∏—é –∞–≤—Ç–æ—Ä–æ–≤
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥ 0-100

- `calculate_time_decay(review_time, current_time)` - –í—Ä–µ–º–µ–Ω–Ω–æ–µ –∑–∞—Ç—É—Ö–∞–Ω–∏–µ
  - –§–æ—Ä–º—É–ª–∞: w_time = 2^(-Œît / T_1/2)
  - –ü–µ—Ä–∏–æ–¥ –ø–æ–ª—É—Ä–∞—Å–ø–∞–¥–∞: 180 –¥–Ω–µ–π

- `calculate_author_weight(author)` - –í–µ—Å –ø–æ —Ä–µ–ø—É—Ç–∞—Ü–∏–∏
  - –ù–æ–≤–∏—á–æ–∫ (<100): 0.5
  - –ê–∫—Ç–∏–≤–Ω—ã–π (100-1000): 1.0
  - –≠–∫—Å–ø–µ—Ä—Ç (>1000): 1.5

- `normalize_rating(rating)` - –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ü–µ–Ω–∫–∏ 1-5 –≤ [0;1]
  - –§–æ—Ä–º—É–ª–∞: (rating - 1) / 4

- `_get_poi_reviews(poi)` - –ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–∑—ã–≤–æ–≤
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä—è–º—É—é —Å–≤—è–∑—å (poi.reviews) –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–∞
  - –ò–Ω–∞—á–µ –∏—â–µ—Ç –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º (—Ä–∞–¥–∏—É—Å 50–º)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–µ –∑–∞—Ç—É—Ö–∞–Ω–∏–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏
- –£—á–µ—Ç —Ä–µ–ø—É—Ç–∞—Ü–∏–∏ –∞–≤—Ç–æ—Ä–∞ –æ—Ç–∑—ã–≤–∞
- –ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ 50.0 –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –æ—Ç–∑—ã–≤–æ–≤

### 3. ‚úÖ HealthImpactScoreCalculator - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω
**–§–∞–π–ª:** `maps/services/health_impact_score_calculator.py`

**–ú–µ—Ç–æ–¥—ã:**
- `calculate_his(poi, S_infra=None, S_social=None)` - –†–∞—Å—á–µ—Ç –∏—Ç–æ–≥–æ–≤–æ–≥–æ HIS
  - –û–±—ä–µ–¥–∏–Ω—è–µ—Ç S_infra (–≤–µ—Å 0.7) –∏ S_social (–≤–µ—Å 0.3)
  - –î–æ–±–∞–≤–ª—è–µ—Ç –±–æ–Ω—É—Å +5 –∑–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç S_HIS 0-100

- `calculate_full_rating(poi, save=True)` - –ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ—Å—á–µ—Ç
  - –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
  - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ POIRating –ø—Ä–∏ save=True
  - –û–±–Ω–æ–≤–ª—è–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ä–∞—Å—á–µ—Ç–∞

- `recalculate_for_category(category)` - –ú–∞—Å—Å–æ–≤—ã–π –ø–µ—Ä–µ—Å—á–µ—Ç
  - –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥–∏ –¥–ª—è –≤—Å–µ—Ö POI –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –í–∑–≤–µ—à–µ–Ω–Ω–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –ë–æ–Ω—É—Å –∑–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é –æ–±—ä–µ–∫—Ç–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

## üìä –§–æ—Ä–º—É–ª—ã

### S_infra (–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥)
```
S_infra_raw = sum(w_i * s_i) / sum(|w_i|)
S_infra = min(100, max(0, 100 * S_infra_raw))
```

### S_social (–°–æ—Ü–∏–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥)
```
s_rating = (rating - 1) / 4
w_time = 2^(-Œît / T_1/2)
w_author = f(reputation)
w_review = w_time * w_author
S_social = sum(s_rating * w_review) / sum(w_review) * 100
```

### S_HIS (Health Impact Score)
```
S_base = 0.7 * S_infra + 0.3 * S_social
S_HIS = S_base + bonus_verification (–µ—Å–ª–∏ verified)
S_HIS = min(100, max(0, S_HIS))
```

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

- [x] InfrastructureScoreCalculator —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [x] SocialScoreCalculator —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [x] HealthImpactScoreCalculator —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [x] –í—Å–µ –º–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [x] –ù–µ—Ç TODO –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
- [x] –ù–µ—Ç –æ—à–∏–±–æ–∫ –ª–∏–Ω—Ç–µ—Ä–∞
- [x] –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ñ–æ—Ä–º—É–ª–∞–º –∏–∑ –¢–ó

## üöÄ –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥

**–≠–¢–ê–ü 3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å LLM (–û–ü–¶–ò–û–ù–ê–õ–¨–ù–û)**
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GIGACHAT API
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è LLMService
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ö–µ–º –∞–Ω–∫–µ—Ç —á–µ—Ä–µ–∑ LLM
- –ê–Ω–∞–ª–∏–∑ –æ—Ç–∑—ã–≤–æ–≤ —á–µ—Ä–µ–∑ LLM

---

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 2025-12-06
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–û–¢–û–í–û


# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ OpenSearch –¥–ª—è —Ç–æ—á–Ω—ã—Ö –≥–µ–æ–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è OpenSearch –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –∏ –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ POI –ø–æ —Ä–∞–¥–∏—É—Å—É.

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
- ‚úÖ **–¢–æ—á–Ω–æ—Å—Ç—å**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ—á–Ω—ã–µ –≥–µ–æ–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –≤–º–µ—Å—Ç–æ –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω—ã—Ö —Ä–∞—Å—á–µ—Ç–æ–≤
- ‚úÖ **–°–∫–æ—Ä–æ—Å—Ç—å**: –ò–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞–º–Ω–æ–≥–æ –±—ã—Å—Ç—Ä–µ–µ
- ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –±–æ–ª—å—à–∏–º–∏ –æ–±—ä–µ–º–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **Fallback**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ Django ORM –µ—Å–ª–∏ OpenSearch –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ OpenSearch

### –í–∞—Ä–∏–∞–Ω—Ç 1: Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
docker run -d \
  --name opensearch \
  -p 9200:9200 \
  -p 9600:9600 \
  -e "discovery.type=single-node" \
  -e "OPENSEARCH_INITIAL_ADMIN_PASSWORD=admin" \
  opensearchproject/opensearch:latest
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: Homebrew (macOS)

```bash
brew install opensearch
brew services start opensearch
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –°–∫–∞—á–∞—Ç—å —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–∞–π—Ç–∞

https://opensearch.org/downloads.html

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Python –∫–ª–∏–µ–Ω—Ç

```bash
pip install opensearch-py
```

–ò–ª–∏ —á–µ—Ä–µ–∑ requirements.txt (—É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω):
```bash
pip install -r requirements.txt
```

### 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–æ–±–∞–≤—å—Ç–µ –≤ `.env` —Ñ–∞–π–ª:

```env
# OpenSearch –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
OPENSEARCH_HOST=localhost
OPENSEARCH_PORT=9200
OPENSEARCH_USE_SSL=False
OPENSEARCH_VERIFY_CERTS=True

# –ï—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:
OPENSEARCH_USERNAME=admin
OPENSEARCH_PASSWORD=admin
```

### 3. –ü–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ POI

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ OpenSearch –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
python manage.py reindex_pois
```

–≠—Ç–æ –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ POI –≤ OpenSearch.

## üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

POI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è —Å OpenSearch –ø—Ä–∏:
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ POI
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–∏ POI
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–∏ POI
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞ POI

–°–∏–≥–Ω–∞–ª—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤ `maps/signals.py`.

## üìä –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –í –∫–æ–¥–µ

```python
from maps.services.opensearch_service import OpenSearchService

opensearch = OpenSearchService()

# –ü–æ–∏—Å–∫ –≤ —Ä–∞–¥–∏—É—Å–µ
results = opensearch.search_in_radius(
    center_lat=55.7558,
    center_lon=37.6173,
    radius_meters=1000,
    category_filters=['pharmacy', 'medical']
)
```

### API

API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç OpenSearch –µ—Å–ª–∏ –æ–Ω –¥–æ—Å—Ç—É–ø–µ–Ω:

- `POST /api/maps/analyze/` - –∞–Ω–∞–ª–∏–∑ –æ–±–ª–∞—Å—Ç–∏ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç OpenSearch –¥–ª—è —Ä–∞–¥–∏—É—Å–∞)
- `GET /api/maps/pois/in-bbox/` - POI –≤ bounding box

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

```bash
curl http://localhost:9200
```

–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–ª–∞—Å—Ç–µ—Ä–µ OpenSearch.

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω–¥–µ–∫—Å

```bash
curl http://localhost:9200/pois/_search?pretty
```

–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö POI.

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ Django

```python
python manage.py shell

from maps.services.opensearch_service import OpenSearchService
opensearch = OpenSearchService()
print(f"OpenSearch enabled: {opensearch.enabled}")
```

## ‚ö†Ô∏è Fallback —Ä–µ–∂–∏–º

–ï—Å–ª–∏ OpenSearch –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Django ORM —Å –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω—ã–º–∏ —Ä–∞—Å—á–µ—Ç–∞–º–∏. –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–∞–∂–µ –±–µ–∑ OpenSearch.

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ OpenSearch –∑–∞–ø—É—â–µ–Ω:
   ```bash
   curl http://localhost:9200
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `.env`:
   - `OPENSEARCH_HOST`
   - `OPENSEARCH_PORT`

### POI –Ω–µ –∏–Ω–¥–µ–∫—Å–∏—Ä—É—é—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Django –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–∏–≥–Ω–∞–ª—ã –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –≤ `maps/apps.py`
3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é –≤—Ä—É—á–Ω—É—é:
   ```bash
   python manage.py reindex_pois
   ```

### –ù–µ—Ç–æ—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ POI –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω—ã:
   ```bash
   curl http://localhost:9200/pois/_count
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

OpenSearch –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É—Å–∫–æ—Ä—è–µ—Ç –≥–µ–æ–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:

- **–ë–µ–∑ OpenSearch**: O(n) - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥–æ–π —Ç–æ—á–∫–∏
- **–° OpenSearch**: O(log n) - –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–∏—Å–∫

–î–ª—è 10,000 POI:
- Django ORM: ~500-1000ms
- OpenSearch: ~10-50ms

## üîó –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [OpenSearch Documentation](https://opensearch.org/docs/)
- [Geo Distance Query](https://opensearch.org/docs/latest/query-dsl/geo/geo-distance/)
- [Geo Bounding Box Query](https://opensearch.org/docs/latest/query-dsl/geo/geo-bounding-box/)


# ‚úÖ –≠–¢–ê–ü 1: –û—á–∏—Å—Ç–∫–∞ –ë–î –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π - –ó–ê–í–ï–†–®–ï–ù

## üéâ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

### ‚úÖ –ó–∞–¥–∞—á–∞ 1.1: –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç –æ—á–∏—Å—Ç–∫–∏ –ë–î

**–§–∞–π–ª:** `maps/management/commands/cleanup_database.py`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö POIRating
- –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö POI (—Å –æ–ø—Ü–∏–µ–π —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –æ—Ç–∑—ã–≤–∞–º–∏)
- –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö FormSchema
- –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö POICategory
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (User, UserProfile, Review) - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
# –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞
python manage.py cleanup_database --confirm

# –° —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º POI, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –æ—Ç–∑—ã–≤–∞–º–∏
python manage.py cleanup_database --confirm --keep-users-data
```

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- –¢—Ä–µ–±—É–µ—Ç —Ñ–ª–∞–≥ `--confirm` –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç–∏
- –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π

---

### ‚úÖ –ó–∞–¥–∞—á–∞ 1.2: –û–±–Ω–æ–≤–ª–µ–Ω–∞ –º–æ–¥–µ–ª—å POI

**–§–∞–π–ª:** `maps/models.py`

**–î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –ø–æ–ª—è:**

1. **moderation_status** (CharField)
   - –°—Ç–∞—Ç—É—Å –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –∑–∞—è–≤–∫–∏
   - –í–∞—Ä–∏–∞–Ω—Ç—ã: `pending`, `approved`, `rejected`, `changes_requested`
   - –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: `approved` (–¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–ø–∏—Å–µ–π)

2. **submitted_by** (ForeignKey ‚Üí User)
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, —Å–æ–∑–¥–∞–≤—à–∏–π –∑–∞—è–≤–∫—É
   - –°–≤—è–∑–∞–Ω–Ω–æ–µ –∏–º—è: `submitted_pois`
   - Nullable: –î–∞

3. **moderated_by** (ForeignKey ‚Üí User)
   - –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π –æ–±—Ä–∞–±–æ—Ç–∞–ª –∑–∞—è–≤–∫—É
   - –°–≤—è–∑–∞–Ω–Ω–æ–µ –∏–º—è: `moderated_pois`
   - Nullable: –î–∞

4. **moderated_at** (DateTimeField)
   - –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏
   - Nullable: –î–∞

5. **moderation_comment** (TextField)
   - –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞
   - –ú–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º

6. **llm_verdict** (JSONField)
   - –í–µ—Ä–¥–∏–∫—Ç LLM –ø—Ä–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–µ
   - –°—Ç—Ä—É–∫—Ç—É—Ä–∞:
     ```json
     {
       "verdict": "approve|reject|review",
       "confidence": 0.0-1.0,
       "comment": "–¢–µ–∫—Å—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –æ—Ç LLM",
       "checked_at": "2024-01-01T00:00:00Z",
       "analysis": {
         "field_quality": "good|medium|poor",
         "health_impact": "positive|neutral|negative",
         "data_completeness": 0.0-1.0
       }
     }
     ```

---

### ‚úÖ –ó–∞–¥–∞—á–∞ 1.3: –°–æ–∑–¥–∞–Ω–∞ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è

**–§–∞–π–ª:** `maps/migrations/0003_add_moderation_fields_to_poi.py`

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `SeparateDatabaseAndState` –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –ø–æ–ª–µ–π –≤ –ë–î –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º (—á–µ—Ä–µ–∑ SQL)
- –û–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ Django ORM –±–µ–∑ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
- –ü—Ä–∏–º–µ–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ

**–ú–∏–≥—Ä–∞—Ü–∏—è –≤–∫–ª—é—á–∞–µ—Ç:**
- SQL –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª–µ–π (—Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è)
- State –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è Django ORM

---

## üìä –°—Ç–∞—Ç—É—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

- [x] –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç `cleanup_database.py`
- [x] –û–±–Ω–æ–≤–ª–µ–Ω–∞ –º–æ–¥–µ–ª—å POI (–¥–æ–±–∞–≤–ª–µ–Ω—ã 6 –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π)
- [x] –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è `0003_add_moderation_fields_to_poi`
- [x] –ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ú–æ–¥–µ–ª—å POI - –Ω–æ–≤—ã–µ –ø–æ–ª—è

```python
MODERATION_STATUS_CHOICES = [
    ('pending', '–û–∂–∏–¥–∞–µ—Ç –º–æ–¥–µ—Ä–∞—Ü–∏–∏'),
    ('approved', '–û–¥–æ–±—Ä–µ–Ω–æ'),
    ('rejected', '–û—Ç–∫–ª–æ–Ω–µ–Ω–æ'),
    ('changes_requested', '–¢—Ä–µ–±—É—é—Ç—Å—è –∏–∑–º–µ–Ω–µ–Ω–∏—è'),
]

moderation_status = models.CharField(
    max_length=20,
    choices=MODERATION_STATUS_CHOICES,
    default='approved',
    verbose_name='–°—Ç–∞—Ç—É—Å –º–æ–¥–µ—Ä–∞—Ü–∏–∏'
)

submitted_by = models.ForeignKey(
    User,
    on_delete=models.SET_NULL,
    null=True,
    blank=True,
    related_name='submitted_pois',
    verbose_name='–°–æ–∑–¥–∞–ª'
)

moderated_by = models.ForeignKey(
    User,
    on_delete=models.SET_NULL,
    null=True,
    blank=True,
    related_name='moderated_pois',
    verbose_name='–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä'
)

moderated_at = models.DateTimeField(
    null=True,
    blank=True,
    verbose_name='–î–∞—Ç–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏'
)

moderation_comment = models.TextField(
    blank=True,
    verbose_name='–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞'
)

llm_verdict = models.JSONField(
    default=dict,
    blank=True,
    verbose_name='–í–µ—Ä–¥–∏–∫—Ç LLM'
)
```

---

## ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —ç—Ç–∞–ø—É

–≠–¢–ê–ü 1 –∑–∞–≤–µ—Ä—à–µ–Ω. –í—Å–µ –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã:

1. ‚úÖ –°–∫—Ä–∏–ø—Ç –æ—á–∏—Å—Ç–∫–∏ –ë–î —Å–æ–∑–¥–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
2. ‚úÖ –ú–æ–¥–µ–ª—å POI –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –≤—Å–µ–º–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ –ø–æ–ª—è–º–∏
3. ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞

**–°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø:** –≠–¢–ê–ü 2: –°–∏—Å—Ç–µ–º–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏–∑ Excel

---

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 2025-12-07  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–û–¢–û–í–û


# ‚úÖ –≠–¢–ê–ü 2: –°–∏—Å—Ç–µ–º–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏–∑ Excel - –ó–ê–í–ï–†–®–ï–ù

## üéâ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

### ‚úÖ –ó–∞–¥–∞—á–∞ 2.1: –°–æ–∑–¥–∞–Ω —Å–µ—Ä–≤–∏—Å –∞–Ω–∞–ª–∏–∑–∞ Excel

**–§–∞–π–ª:** `maps/services/excel_category_analyzer.py`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**

1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å Excel —Ñ–∞–π–ª–æ–º**
   - –ó–∞–≥—Ä—É–∑–∫–∞ Excel —Ñ–∞–π–ª–∞ —á–µ—Ä–µ–∑ pandas –∏ openpyxl
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏

2. **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö –∫–æ–ª–æ–Ω–æ–∫**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ: `text`, `number`, `boolean`, `date`, `coordinate`
   - –ê–Ω–∞–ª–∏–∑ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç (—à–∏—Ä–æ—Ç–∞/–¥–æ–ª–≥–æ—Ç–∞ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–∞—Ö -180..180, -90..90)
   - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –±—É–ª–µ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
   - –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –¥–∞—Ç

3. **–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –ø–æ–ª–µ–π —Ñ–æ—Ä–º—ã**
   - `boolean` - –¥–ª—è –±—É–ª–µ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
   - `range` - –¥–ª—è —á–∏—Å–ª–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –≤ —Ä–∞–∑—É–º–Ω—ã—Ö –¥–∏–∞–ø–∞–∑–æ–Ω–∞—Ö
   - `select` - –¥–ª—è –ø–æ–ª–µ–π —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º –Ω–∞–±–æ—Ä–æ–º –∑–Ω–∞—á–µ–Ω–∏–π (–¥–æ 10 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö)
   - `text` - –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

4. **–ê–Ω–∞–ª–∏–∑ –ª–∏—Å—Ç–∞ Excel**
   - –ú–µ—Ç–æ–¥ `analyze_sheet()` - –ø–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –≤—Å–µ—Ö –∫–æ–ª–æ–Ω–æ–∫
   - –ú–µ—Ç–æ–¥ `suggest_form_schema()` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã FormSchema

**–ú–µ—Ç–æ–¥—ã:**
- `get_all_sheets()` - –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ª–∏—Å—Ç–æ–≤
- `analyze_sheet(sheet_name)` - –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ª–∏—Å—Ç
- `suggest_form_schema(sheet_name)` - –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Å—Ö–µ–º—É —Ñ–æ—Ä–º—ã
- `_detect_column_type(series)` - –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–∏–ø –∫–æ–ª–æ–Ω–∫–∏
- `_suggest_field_type(...)` - –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Ç–∏–ø –ø–æ–ª—è —Ñ–æ—Ä–º—ã

---

### ‚úÖ –ó–∞–¥–∞—á–∞ 2.2: –°–æ–∑–¥–∞–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ –∏–º–ø–æ—Ä—Ç–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π

**–§–∞–π–ª:** `maps/management/commands/import_categories_from_excel.py`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**

1. **–ò–º–ø–æ—Ä—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏–∑ Excel**
   - –ß—Ç–µ–Ω–∏–µ Excel —Ñ–∞–π–ª–∞
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–∂–¥–æ–≥–æ –ª–∏—Å—Ç–∞ –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
   - –°–æ–∑–¥–∞–Ω–∏–µ –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π

2. **–†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã:**
   - `--dry-run` - –ø—Ä–æ—Å–º–æ—Ç—Ä –±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
   - `--use-predefined` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –ø–æ–ª—è –≤–º–µ—Å—Ç–æ –∞–Ω–∞–ª–∏–∑–∞ Excel

3. **–°–æ–∑–¥–∞–Ω–∏–µ —Å—Ö–µ–º —Ñ–æ—Ä–º**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∫–æ–ª–æ–Ω–æ–∫ Excel
   - –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –ø–æ–ª–µ–π
   - –°–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ FormSchema

4. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**
   - –ü–æ–¥—Å—á–µ—Ç —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö/–æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
   - –ü–æ–¥—Å—á–µ—Ç —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö/–æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Å—Ö–µ–º
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
python manage.py import_categories_from_excel file.xlsx --dry-run

# –ò–º–ø–æ—Ä—Ç —Å –∞–Ω–∞–ª–∏–∑–æ–º Excel
python manage.py import_categories_from_excel file.xlsx

# –ò–º–ø–æ—Ä—Ç —Å –ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º–∏ –ø–æ–ª—è–º–∏
python manage.py import_categories_from_excel file.xlsx --use-predefined
```

---

### ‚úÖ –ó–∞–¥–∞—á–∞ 2.3: –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –ø–æ–ª—è –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π

**–§–∞–π–ª:** `maps/services/category_fields_definition.py`

**–û–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:**

1. **–¢–æ—á–∫–∏ —Å–±–æ—Ä–∞ –º—É—Å–æ—Ä–∞**
   - –¢–∏–ø —Ç–æ—á–∫–∏ (select)
   - –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–æ—á–∫–∏ (select)
   - –ß–∞—Å—Ç–æ—Ç–∞ –≤—ã–≤–æ–∑–∞ (select)
   - –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –¥–ª—è –∏–Ω–≤–∞–ª–∏–¥–æ–≤ (boolean)
   - –ü–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ (boolean)

2. **–ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–µ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è**
   - –¢–∏–ø –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è (select)
   - –≠–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∫–ª–∞—Å—Å (select)
   - –ù–∞–ª–∏—á–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ (boolean)
   - –£—Ä–æ–≤–µ–Ω—å —à—É–º–∞ (range)

3. **–ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ø–∏—Ç–∞–Ω–∏—è**
   - –ü—Ä–æ–¥–∞–∂–∞ –∞–ª–∫–æ–≥–æ–ª—è (boolean)
   - –•–æ—Ä–æ—à–∞—è —Ä–µ–∫–ª–∞–º–∞ (boolean)
   - –ü–ª–æ—Ö–∞—è —Ä–µ–∫–ª–∞–º–∞ (boolean)
   - –í–µ–≥–µ—Ç–∞—Ä–∏–∞–Ω—Å–∫–æ–µ –º–µ–Ω—é (boolean)
   - –ì–∏–≥–∏–µ–Ω–∏—á–µ—Å–∫–∏–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (boolean)

4. **–ú–∞–≥–∞–∑–∏–Ω—ã**
   - –¢–∏–ø –º–∞–≥–∞–∑–∏–Ω–∞ (select)
   - –û—Ä–≥–∞–Ω–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–¥—É–∫—Ç—ã (boolean)
   - –ü—Ä–æ–¥–∞–∂–∞ –∞–ª–∫–æ–≥–æ–ª—è (boolean)
   - –ü—Ä–æ–¥–∞–∂–∞ —Ç–∞–±–∞–∫–∞ (boolean)
   - –ö–∞—á–µ—Å—Ç–≤–æ —Å–≤–µ–∂–∏—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ (range)

5. **–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏**
   - –¢–∏–ø –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (select)
   - –°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (text)
   - –ù–∞–ª–∏—á–∏–µ –ª–∏—Ü–µ–Ω–∑–∏–∏ (boolean)
   - –ö—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞ (boolean)
   - –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –¥–ª—è –∏–Ω–≤–∞–ª–∏–¥–æ–≤ (boolean)
   - –°–ª—É–∂–±–∞ —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–π –ø–æ–º–æ—â–∏ (boolean)

**–§—É–Ω–∫—Ü–∏–∏:**
- `get_fields_for_category(category_name)` - –ø–æ–ª—É—á–∏—Ç—å –ø–æ–ª—è –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- `create_form_schema_for_category(category, fields_definition)` - —Å–æ–∑–¥–∞—Ç—å —Å—Ö–µ–º—É –∏–∑ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è

---

## üì¶ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

**–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ `requirements.txt`:**
- `pandas>=2.0.0` - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Excel —Ñ–∞–π–ª–∞–º–∏
- `openpyxl>=3.1.0` - –¥–≤–∏–∂–æ–∫ –¥–ª—è —á—Ç–µ–Ω–∏—è .xlsx —Ñ–∞–π–ª–æ–≤

---

## üìä –°—Ç–∞—Ç—É—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

- [x] –°–æ–∑–¥–∞–Ω `ExcelCategoryAnalyzer` —Å –ø–æ–ª–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º –∞–Ω–∞–ª–∏–∑–∞
- [x] –°–æ–∑–¥–∞–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `import_categories_from_excel`
- [x] –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –ø–æ–ª—è –¥–ª—è 5 –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ö–µ–º –∏–∑ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π
- [x] –î–æ–±–∞–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ requirements.txt

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä Excel

**–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –∫–æ–ª–æ–Ω–æ–∫:**
- –ê–Ω–∞–ª–∏–∑ –ø–µ—Ä–≤—ã—Ö 10 –∑–Ω–∞—á–µ–Ω–∏–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (–¥–∏–∞–ø–∞–∑–æ–Ω—ã)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —á–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (80%+)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –±—É–ª–µ–≤—ã –∑–Ω–∞—á–µ–Ω–∏—è (80%+ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥–∞—Ç—ã (70%+)

**–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª–µ–π:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–µ—Å–æ–≤
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ/–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ)
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤–µ—Å–æ–≤ –¥–æ —Å—É–º–º—ã ~1.0

### –ö–æ–º–∞–Ω–¥–∞ –∏–º–ø–æ—Ä—Ç–∞

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- Dry-run —Ä–µ–∂–∏–º –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–ì–∏–±–∫–æ—Å—Ç—å:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –ø–æ–ª–µ–π –∏–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è slug –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ö–µ–º —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º 'draft' –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

---

## ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —ç—Ç–∞–ø—É

–≠–¢–ê–ü 2 –∑–∞–≤–µ—Ä—à–µ–Ω. –í—Å–µ –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã:

1. ‚úÖ –°–µ—Ä–≤–∏—Å –∞–Ω–∞–ª–∏–∑–∞ Excel —Å–æ–∑–¥–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
2. ‚úÖ –ö–æ–º–∞–Ω–¥–∞ –∏–º–ø–æ—Ä—Ç–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
3. ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –ø–æ–ª—è –¥–ª—è 5 –∫–∞—Ç–µ–≥–æ—Ä–∏–π

**–°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø:** –≠–¢–ê–ü 3: –†—É—á–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –º–µ—Å—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º

---

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 2025-12-07  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–û–¢–û–í–û

